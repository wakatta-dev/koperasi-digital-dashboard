digraph G {
  graph [rankdir=LR];
  node [shape=record, fontsize=10];

  // Authentication tables
  tenants [label="{tenants|id PK|domain|type|status}" fillcolor=lightblue style=filled];
  roles [label="{roles|id PK|name|jenis_tenant}" fillcolor=lightyellow style=filled];
  tenant_roles [label="{tenant_roles|id PK|tenant_id FK|role_id FK}" fillcolor=lightyellow style=filled];
  users [label="{users|id PK|tenant_id FK|tenant_role_id FK|email}" fillcolor=lightyellow style=filled];
  role_users [label="{role_users|id PK|user_id FK|role_id FK|tenant_id FK}" fillcolor=lightyellow style=filled];
  refresh_tokens [label="{refresh_tokens|token PK|user_id FK}" fillcolor=lightyellow style=filled];
  casbin_rule [label="{casbin_rule|id PK|ptype|v0..v5}" fillcolor=lightyellow style=filled];

  // Tenant management tables
  modules [label="{modules|id PK|code|name}" fillcolor=lightblue style=filled];
  tenant_modules [label="{tenant_modules|id PK|tenant_id FK|module_id FK}" fillcolor=lightblue style=filled];
  user_tenant_access [label="{user_tenant_access|id PK|user_id FK|tenant_id FK|tenant_role_id FK}" fillcolor=lightblue style=filled];
  plans [label="{plans|id PK|name|type|module_code}" fillcolor=lightblue style=filled];
  tenant_plans [label="{tenant_plans|tenant_id FK|plan_id FK|is_primary}" fillcolor=lightblue style=filled];
  tenant_subscriptions [label="{tenant_subscriptions|id PK|tenant_id FK|plan_id FK}" fillcolor=lightblue style=filled];
  notifications [label="{notifications|id PK|tenant_id FK|user_id FK}" fillcolor=lightblue style=filled];
  module_usage_logs [label="{module_usage_logs|tenant_id FK|module_code}" fillcolor=lightblue style=filled];

  // Finance tables
  invoices [label="{invoices|id PK|tenant_id FK|subscription_id FK|number}" fillcolor=lightgreen style=filled];
  invoice_items [label="{invoice_items|id PK|invoice_id FK}" fillcolor=lightgreen style=filled];
  payments [label="{payments|id PK|invoice_id FK|amount}" fillcolor=lightgreen style=filled];
  cash_transactions [label="{cash_transactions|id PK|tenant_id FK|type|amount}" fillcolor=lightgreen style=filled];
  ledger_entries [label="{ledger_entries|id PK|transaction_id FK|account_code}" fillcolor=lightgreen style=filled];
  transaction_history [label="{transaction_history|id PK|transaction_id FK}" fillcolor=lightgreen style=filled];
  status_audits [label="{status_audits|id PK|entity_type|entity_id|changed_by}" fillcolor=lightgreen style=filled];

  // Relationships
  tenant_roles -> tenants [label="tenant_id"]; 
  tenant_roles -> roles [label="role_id"]; 
  users -> tenants [label="tenant_id"]; 
  users -> tenant_roles [label="tenant_role_id"]; 
  role_users -> users [label="user_id"]; 
  role_users -> roles [label="role_id"]; 
  role_users -> tenants [label="tenant_id"]; 
  refresh_tokens -> users [label="user_id"]; 
  tenant_modules -> tenants [label="tenant_id"]; 
  tenant_modules -> modules [label="module_id"]; 
  user_tenant_access -> users [label="user_id"]; 
  user_tenant_access -> tenants [label="tenant_id"]; 
  user_tenant_access -> tenant_roles [label="tenant_role_id"]; 
  tenant_plans -> tenants [label="tenant_id"]; 
  tenant_plans -> plans [label="plan_id"]; 
  tenant_subscriptions -> tenants [label="tenant_id"]; 
  tenant_subscriptions -> plans [label="plan_id"]; 
  invoices -> tenants [label="tenant_id"]; 
  invoices -> tenant_subscriptions [label="subscription_id"]; 
  invoice_items -> invoices [label="invoice_id"]; 
  payments -> invoices [label="invoice_id"]; 
  cash_transactions -> tenants [label="tenant_id"]; 
  ledger_entries -> cash_transactions [label="transaction_id"]; 
  transaction_history -> cash_transactions [label="transaction_id"]; 
  notifications -> tenants [label="tenant_id"]; 
  notifications -> users [label="user_id"]; 
  module_usage_logs -> tenants [label="tenant_id"]; 
}
